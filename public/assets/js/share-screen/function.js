var room_id,local_stream,screenStream,getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,peer=null,currentPeer=null,screenSharing=!1,cameraOn=!0;function toggleCamera(){cameraOn?stopCamera():startCamera()}function startCamera(){getUserMedia({video:!0,audio:!0},(e=>{console.log(e),setLocalStream(local_stream=e),cameraOn=!0,document.getElementById("cameraIcon").classList.remove("fa-video-slash"),document.getElementById("cameraIcon").classList.add("fa-video"),document.getElementById("cameraStatus").innerText="Turn Off Camera"}),(e=>{console.log(e)}))}function stopCamera(){local_stream.getVideoTracks().forEach((e=>e.stop())),document.getElementById("local-video").srcObject=null,cameraOn=!1,document.getElementById("cameraIcon").classList.remove("fa-video"),document.getElementById("cameraIcon").classList.add("fa-video-slash"),document.getElementById("cameraStatus").innerText="Turn On Camera"}function createRoom(){console.log("Creating Room");let e=document.getElementById("room-input").value;" "!=e&&""!=e?(room_id=e,(peer=new Peer(room_id)).on("open",(e=>{console.log("Peer Room ID: ",e),getUserMedia({video:!0,audio:!0},(e=>{console.log(e),setLocalStream(local_stream=e)}),(e=>{console.log(e)})),alert("Room created successfully!")})),peer.on("call",(e=>{e.answer(local_stream),e.on("stream",(e=>{console.log("got call"),console.log(e),setRemoteStream(e)})),currentPeer=e}))):alert("Please enter room number")}function setLocalStream(e){document.getElementById("local-vid-container").hidden=!1,document.getElementById("buttons").hidden=!1;let t=document.getElementById("local-video");t.srcObject=e,t.muted=!0,t.play()}function setScreenSharingStream(e){document.getElementById("screenshare-container").hidden=!1;let t=document.getElementById("screenshared-video");t.srcObject=e,t.muted=!0,t.play()}function setRemoteStream(e){document.getElementById("remote-vid-container").hidden=!1;let t=document.getElementById("remote-video");t.srcObject=e,t.play()}function notify(e){let t=document.getElementById("notification");t.innerHTML=e,t.hidden=!1,setTimeout((()=>{t.hidden=!0}),3e3)}function joinRoom(){console.log("Joining Room");let e=document.getElementById("room-input").value;" "!=e&&""!=e?(room_id=e,(peer=new Peer).on("open",(e=>{console.log("Connected room with Id: "+e),getUserMedia({video:!0,audio:!1},(e=>{setLocalStream(local_stream=e),alert("Successfully joined the room!");let t=peer.call(room_id,e);t.on("stream",(e=>{setRemoteStream(e)})),currentPeer=t}),(e=>{console.log(e)}))}))):alert("Please enter room number")}function startScreenShare(){screenSharing&&stopScreenSharing(),navigator.mediaDevices.getDisplayMedia({video:!0}).then((e=>{setScreenSharingStream(e);let t=(screenStream=e).getVideoTracks()[0];if(t.onended=()=>{stopScreenSharing()},peer){currentPeer.peerConnection.getSenders().find((function(e){return e.track.kind==t.kind})).replaceTrack(t),screenSharing=!0}console.log(screenStream)}))}function stopScreenSharing(){if(!screenSharing)return;let e=local_stream.getVideoTracks()[0];if(peer){currentPeer.peerConnection.getSenders().find((function(t){return t.track.kind==e.kind})).replaceTrack(e)}screenStream.getTracks().forEach((function(e){e.stop()})),screenSharing=!1}